<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bright Academy Marks Analysis</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
    input[type="number"] { width: 60px; }
    .hidden { display: none; }
    .btn { margin: 10px 5px; padding: 8px 16px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Bright Academy - Marks Management System</h1>

  <div id="loginSection">
    <label for="username">Username:</label>
    <input type="text" id="username" />
    <label for="password">Password:</label>
    <input type="password" id="password" />
    <button onclick="login()">Login</button>
  </div>

  <div id="mainSection" class="hidden">
    <h2>Welcome, <span id="userRole"></span></h2>
    <button id="analyzeBtn" class="btn hidden" onclick="analyze()">Analyze Marks</button>
    <div id="reportForm" class="hidden">
      <h2>Individual Student Report</h2>
      <label for="studentSelect">Select Student:</label>
      <select id="studentSelect" onchange="generateReport()">
        <option value="">-- Select --</option>
      </select>
      <div id="reportContent" style="margin-top: 20px; border: 1px solid #ccc; padding: 15px;"></div>
      <button class="btn" onclick="printReport()">Print Report</button>
    </div>
    <table id="marksTable">
      <thead>
        <tr>
          <th>Class</th>
          <th>Student Name</th>
          <th>Math</th>
          <th>English</th>
          <th>Kiswahili</th>
          <th>Biology</th>
          <th>Chemistry</th>
          <th>CRE</th>
          <th>History</th>
          <th>Agriculture</th>
          <th>Physics</th>
          <th>Geography</th>
          <th>Average</th>
          <th>Grade</th>
          <th>Save</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <script>
    const users = {
      math: 'math123',
      english: 'eng123',
      kiswahili: 'kis123',
      biology: 'bio123',
      chemistry: 'chem123',
      cre: 'cre123',
      history: 'hist123',
      agriculture: 'agri123',
      physics: 'phy123',
      geography: 'geo123',
      admin: 'admin123',
    };

    const subjects = ["Math", "English", "Kiswahili", "Biology", "Chemistry", "CRE", "History", "Agriculture", "Physics", "Geography"];

    const students = [
      { name: "Milka Moraa", class: "Form 2 Scarlet" },
      { name: "Grace Wangari", class: "Form 2 Scarlet" },
      { name: "Jane Wanjiru", class: "Form 2 Scarlet" },
      { name: "Precious Wanjiru", class: "Form 2 Scarlet" },

      { name: "Anne Mokeira", class: "Form 2 Lilac" },
      { name: "Mary Onyango", class: "Form 2 Lilac" },
      { name: "Damari Achieng", class: "Form 2 Lilac" },
      { name: "Florian Wangari", class: "Form 2 Lilac" },

      { name: "Hellen Monyangi", class: "Form 3 Peach" },
      { name: "Daisy Rabera", class: "Form 3 Peach" },
      { name: "Jesca Moraa", class: "Form 3 Peach" },
      { name: "Janet Atieno", class: "Form 3 Peach" },

      { name: "Mary Atieno", class: "Form 3 Scarlet" },
      { name: "Florence Achieng", class: "Form 3 Scarlet" },
      { name: "Kerubo James", class: "Form 3 Scarlet" },
      { name: "Monica Kemunto", class: "Form 3 Scarlet" },
    ];

    let currentUser = "";
    const db = {};

    function login() {
      const username = document.getElementById("username").value.toLowerCase();
      const password = document.getElementById("password").value;
      if (users[username] && users[username] === password) {
        currentUser = username;
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("mainSection").classList.remove("hidden");
        document.getElementById("userRole").textContent = username;
        if (username === "admin") {
          document.getElementById("analyzeBtn").classList.remove("hidden");
        }
        generateTable();
      } else {
        alert("Invalid login credentials");
      }
    }

    function generateTable() {
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";
      students.forEach((student, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${student.class}</td><td>${student.name}</td>`;
        subjects.forEach((subject, i) => {
          const td = document.createElement("td");
          const key = `${index}-${subject}`;
          const mark = db[key] || "";
          if (currentUser === subject.toLowerCase() || currentUser === "admin") {
            td.innerHTML = `<input type='number' id='${subject}-${index}' min='0' max='100' value='${mark}' />`;
          } else {
            td.textContent = mark ? mark : "-";
          }
          tr.appendChild(td);
        });
        tr.innerHTML += `<td id='avg-${index}'></td><td id='grade-${index}'></td><td><button onclick='saveMarks(${index})'>Save</button></td>`;
        tbody.appendChild(tr);
      });
    }

    function saveMarks(index) {
      subjects.forEach(subject => {
        const input = document.getElementById(`${subject}-${index}`);
        if (input && input.value !== "") {
          db[`${index}-${subject}`] = input.value;
        }
      });
      alert("Marks for " + students[index].name + " saved to database successfully!");
    }

    function analyze() {
      students.forEach((student, index) => {
        let total = 0;
        let count = 0;
        subjects.forEach(subject => {
          const input = document.getElementById(`${subject}-${index}`);
          if (input && input.value !== "") {
            total += parseFloat(input.value);
            count++;
          }
        });
        const avg = (count > 0) ? (total / count).toFixed(2) : 0;
        const avgCell = document.getElementById(`avg-${index}`);
        const gradeCell = document.getElementById(`grade-${index}`);
        avgCell.textContent = avg;
        gradeCell.textContent = getGrade(avg);
      });
      updateStudentDropdown();
    }

    function getGrade(score) {
      if (score >= 80) return "A";
      if (score >= 70) return "B";
      if (score >= 60) return "C";
      if (score >= 50) return "D";
      return "E";
    }

    function updateStudentDropdown() {
      const rows = document.getElementById("tableBody").querySelectorAll("tr");
      const studentSelect = document.getElementById("studentSelect");
      studentSelect.innerHTML = '<option value="">-- Select --</option>';
      rows.forEach((row, index) => {
        const studentName = row.cells[1].textContent;
        const className = row.cells[0].textContent;
        studentSelect.innerHTML += `<option value="${index}">${studentName} - ${className}</option>`;
      });
      document.getElementById("reportForm").classList.remove("hidden");
    }

    function generateReport() {
      const index = document.getElementById("studentSelect").value;
      if (index === "") return;
      const row = document.getElementById("tableBody").rows[index];
      const className = row.cells[0].textContent;
      const name = row.cells[1].textContent;
      const avg = row.cells[12].textContent;
      const grade = row.cells[13].textContent;

      let subjectMarks = "";
      for (let i = 2; i < 12; i++) {
        const subject = subjects[i - 2];
        const input = row.cells[i].querySelector("input");
        const mark = input ? input.value : row.cells[i].textContent;
        subjectMarks += `<tr><td>${subject}</td><td>${mark}</td></tr>`;
      }

      document.getElementById("reportContent").innerHTML = `
        <h3>Bright Academy</h3>
        <p><strong>Class:</strong> ${className}</p>
        <p><strong>Name:</strong> ${name}</p>
        <p><strong>Average Score:</strong> ${avg}</p>
        <p><strong>Grade:</strong> ${grade}</p>
        <table style="width:100%; border-collapse: collapse;" border="1">
          <tr><th>Subject</th><th>Mark</th></tr>
          ${subjectMarks}
        </table>
        <p style="margin-top:20px;"><strong>Class Teacher's Comment:</strong> __________________________</p>
        <p><strong>Principal's Comment:</strong> __________________________</p>
        <p><strong>Signature:</strong> __________________________</p>
      `;
    }

    function printReport() {
      const content = document.getElementById("reportContent").innerHTML;
      const win = window.open('', '', 'height=700,width=900');
      win.document.write('<html><head><title>Student Report</title></head><body>');
      win.document.write(content);
      win.document.write('</body></html>');
      win.document.close();
      win.print();
    }
  </script>
</body>
</html>
